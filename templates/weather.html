<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Forecast - Energy Management System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --dark-blue: #1a2b4c;
        --medium-blue: #2c4870;
        --light-blue: #7ab5e3;
        --sunset-orange: #ff7e5f;
        --sunset-yellow: #feb47b;
      }

      body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-image: url("https://images.unsplash.com/photo-1509391366360-2e959784a276?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2072&q=80");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        padding-top: 40px;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          to bottom,
          rgba(26, 43, 76, 0.7),
          rgba(44, 72, 112, 0.8)
        );
        z-index: 1;
      }

      .navbar {
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        padding: 1rem 2rem;
        position: relative;
        z-index: 1000;
      }

      .navbar-brand {
        color: white !important;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo {
        height: 40px;
        width: auto;
        object-fit: contain;
        filter: brightness(0) invert(1);
      }

      .nav-link {
        color: white !important;
        margin: 0 1rem;
        transition: all 0.3s ease;
      }

      .nav-link:hover {
        color: var(--sunset-yellow) !important;
      }

      .weather-container {
        position: relative;
        z-index: 2;
        padding: 2rem;
        color: white;
      }

      .weather-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: transform 0.3s ease;
      }

      .weather-card:hover {
        transform: translateY(-5px);
      }

      .current-weather {
        text-align: center;
        padding: 2rem;
      }

      .temperature {
        font-size: 4rem;
        font-weight: bold;
        margin: 1rem 0;
      }

      .weather-icon {
        font-size: 3rem;
        margin: 1rem 0;
      }

      .weather-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 2rem;
      }

      .detail-item {
        text-align: center;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      .forecast-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 2rem;
      }

      .forecast-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 1rem;
        text-align: center;
      }

      .location-search {
        max-width: 500px;
        margin: 0 auto 2rem;
      }

      .search-input {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 50px;
        width: 100%;
        backdrop-filter: blur(5px);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--sunset-yellow);
        box-shadow: 0 0 0 2px rgba(254, 180, 123, 0.3);
      }

      .search-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .loading {
        text-align: center;
        padding: 2rem;
        font-size: 1.2rem;
      }

      .error-message {
        background: rgba(255, 68, 68, 0.1);
        border: 1px solid rgba(255, 68, 68, 0.3);
        color: #ff4444;
        padding: 1rem;
        border-radius: 10px;
        margin: 1rem 0;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg">
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('landing') }}">
          <img
            src="{{ url_for('static', filename='images/gocity.png') }}"
            alt="Energy Management System Logo"
            class="logo"
          />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('landing') }}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('features') }}">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('about') }}">About Us</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('login') }}">Login</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container weather-container">
      <div class="location-search">
        <input
          type="text"
          class="search-input"
          id="locationSearch"
          placeholder="Enter city name..."
        />
      </div>

      <div id="weatherContent">
        <div class="weather-card current-weather">
          <h2 id="location">Loading weather data...</h2>
          <div class="weather-icon" id="weatherIcon">
            <i class="fas fa-spinner fa-spin"></i>
          </div>
          <div class="temperature" id="temperature">--°C</div>
          <div class="weather-description" id="weatherDescription">
            Loading...
          </div>

          <div class="weather-details">
            <div class="detail-item">
              <i class="fas fa-wind"></i>
              <h4>Wind Speed</h4>
              <p id="windSpeed">-- km/h</p>
            </div>
            <div class="detail-item">
              <i class="fas fa-tint"></i>
              <h4>Humidity</h4>
              <p id="humidity">--%</p>
            </div>
            <div class="detail-item">
              <i class="fas fa-compress-arrows-alt"></i>
              <h4>Pressure</h4>
              <p id="pressure">-- hPa</p>
            </div>
            <div class="detail-item">
              <i class="fas fa-eye"></i>
              <h4>Visibility</h4>
              <p id="visibility">-- km</p>
            </div>
          </div>
        </div>

        <div class="weather-card">
          <h3>Hourly Forecast</h3>
          <div class="forecast-container" id="hourlyForecast">
            <!-- Hourly forecast items will be inserted here -->
          </div>
        </div>

        <div class="weather-card">
          <h3>Daily Forecast</h3>
          <div class="forecast-container" id="dailyForecast">
            <!-- Daily forecast items will be inserted here -->
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let searchTimeout;
      const searchInput = document.getElementById("locationSearch");

      searchInput.addEventListener("input", function (e) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          const location = e.target.value;
          if (location.length >= 3) {
            fetchWeatherData(location);
          }
        }, 500);
      });

      async function fetchWeatherData(location) {
        try {
          const response = await fetch(
            `/api/weather?location=${encodeURIComponent(location)}`
          );
          const data = await response.json();

          if (data.error) {
            showError(data.error);
            return;
          }

          updateWeatherUI(data);
        } catch (error) {
          showError("Failed to fetch weather data. Please try again.");
        }
      }

      function updateWeatherUI(data) {
        // Update current weather
        document.getElementById("location").textContent = data.location;
        document.getElementById("temperature").textContent = `${Math.round(
          data.current.temp
        )}°C`;
        document.getElementById("weatherDescription").textContent =
          data.current.weather[0].description;
        document.getElementById(
          "windSpeed"
        ).textContent = `${data.current.wind_speed} km/h`;
        document.getElementById(
          "humidity"
        ).textContent = `${data.current.humidity}%`;
        document.getElementById(
          "pressure"
        ).textContent = `${data.current.pressure} hPa`;
        document.getElementById("visibility").textContent = `${(
          data.current.visibility / 1000
        ).toFixed(1)} km`;

        // Update weather icon
        const weatherIcon = document.getElementById("weatherIcon");
        weatherIcon.innerHTML = getWeatherIcon(data.current.weather[0].icon);

        // Update hourly forecast
        const hourlyForecast = document.getElementById("hourlyForecast");
        hourlyForecast.innerHTML = data.hourly
          .slice(0, 24)
          .map(
            (hour) => `
                <div class="forecast-card">
                    <div>${new Date(hour.dt * 1000).getHours()}:00</div>
                    <div class="weather-icon">${getWeatherIcon(
                      hour.weather[0].icon
                    )}</div>
                    <div>${Math.round(hour.temp)}°C</div>
                </div>
            `
          )
          .join("");

        // Update daily forecast
        const dailyForecast = document.getElementById("dailyForecast");
        dailyForecast.innerHTML = data.daily
          .slice(0, 7)
          .map(
            (day) => `
                <div class="forecast-card">
                    <div>${new Date(day.dt * 1000).toLocaleDateString("en-US", {
                      weekday: "short",
                    })}</div>
                    <div class="weather-icon">${getWeatherIcon(
                      day.weather[0].icon
                    )}</div>
                    <div>${Math.round(day.temp.max)}°C / ${Math.round(
              day.temp.min
            )}°C</div>
                </div>
            `
          )
          .join("");
      }

      function getWeatherIcon(iconCode) {
        const iconMap = {
          "01d": "fa-sun",
          "01n": "fa-moon",
          "02d": "fa-cloud-sun",
          "02n": "fa-cloud-moon",
          "03d": "fa-cloud",
          "03n": "fa-cloud",
          "04d": "fa-cloud",
          "04n": "fa-cloud",
          "09d": "fa-cloud-showers-heavy",
          "09n": "fa-cloud-showers-heavy",
          "10d": "fa-cloud-sun-rain",
          "10n": "fa-cloud-moon-rain",
          "11d": "fa-bolt",
          "11n": "fa-bolt",
          "13d": "fa-snowflake",
          "13n": "fa-snowflake",
          "50d": "fa-smog",
          "50n": "fa-smog",
        };
        return `<i class="fas ${iconMap[iconCode] || "fa-cloud"}"></i>`;
      }

      function showError(message) {
        const weatherContent = document.getElementById("weatherContent");
        weatherContent.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-circle"></i>
                    ${message}
                </div>
            `;
      }

      // Get user's location on page load
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            fetchWeatherData(
              `${position.coords.latitude},${position.coords.longitude}`
            );
          },
          (error) => {
            console.error("Error getting location:", error);
            // Default to a major city if geolocation fails
            fetchWeatherData("London");
          }
        );
      } else {
        // Default to a major city if geolocation is not supported
        fetchWeatherData("London");
      }
    </script>
  </body>
</html>
